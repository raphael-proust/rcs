#!/opt/plan9/bin/rc

TASKPIPESDIR=$home/.task-pipes
if (! ls $TASKPIPESDIR >/dev/null >[2=1]) mkdir $TASKPIPESDIR

switch ($#*) {
case 0
	TASKPIPES=`{ls $TASKPIPESDIR}
	echo $TASKPIPES
	TASKPIPE=`{read}
	switch($TASKPIPE) {
	case ''
		exit ''
	case *
		exec dtach -A $TASKPIPESDIR/$TASKPIPE $SHELL
	}
case 1
	switch $*(1) {
	case -l
		echo `{ls $TASKPIPESDIR}
	case *
		exec dtach -A $TASKPIPESDIR/$*(1) $SHELL
	}
case 2
	switch $*(1) {
	case -a
		exec dtach -a $TASKPIPESDIR/$2
	case *
		exec dtach -A $TASKPIPESDIR/$*(1) $*(2)
	}
case *
	switch $*(1) {
	case -a
		exit "Too many arguments with -a"
	case -[cnA]
		DASHARG=$*(1)
		PIPENAME=$*(2)
		shift 2
		echo $DASHARG
		echo $PIPENAME
		echo $*
		exec dtach $DASHARG $TASKPIPESDIR/$PIPENAME $*
	case *
		PIPENAME=$1
		shift 1
		exec dtach -A $TASKPIPESDIR/$PIPENAME $*
	}
}


