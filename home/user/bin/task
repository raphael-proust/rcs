#!/bin/dash

TASKPIPESDIR="/tmp/task-dtach"
if ! [ -d $TASKPIPESDIR ]
then
  mkdir $TASKPIPESDIR
fi

if [ $# -eq 0 ]
then
  TASKPIPES=$(ls $TASKPIPESDIR)
  if [ $(printf %s "$TASKPIPES" | wc -w) = "0" ]
  then
    echo "No dtached task found"
  else
    dtach -a $TASKPIPESDIR/$(printf %s "$TASKPIPES" | sed -e "s/\s\+/\n/g" | slmenu)
  fi
else
  case "$#" in
    1|2)
      dtach -A $TASKPIPESDIR/$1 $*
      printf %s "$1"
      ;;
    *)
      case "$1" in
        "-c"|"-n"|"-A")
          DASHARG=$1
          PIPENAME=$2
          shift 2
          dtach $DASHARG "$TASKPIPESDIR/$PIPENAME" $*
          printf %s "$PIPENAME"
          ;;
        "-a")
          dtach -a $TASKPIPESDIR/$2
          printf %s "$2"
          ;;
        *)
          dtach -A $TASKPIPESDIR/$1 $*
          printf %s "$1"
          ;;
      esac
      ;;
  esac
fi
