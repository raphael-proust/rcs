#!/bin/dash

ALSAVOL=$(amixer get Master | grep "Mono:" | sed -e "s/.*\[[0-9]*%\].*\[\(.*\)\]$/\1/")
case "$ALSAVOL" in
  on)
    ALSAVOL=$(amixer get Master | grep "Mono:" | sed -e "s/.*\[\([0-9]*%\)\].*\[.*\]$/\1/")
    ;;
  off)
    ;;
esac

if rfkill list wifi | grep -q "Soft blocked: no"
then
  WIFI=$(netcfg current)
else
  WIFI="off"
fi

CPUGOV=$(cpufreq-info -c 0 -p | awk '{print $3}')
case "$CPUGOV" in
  ondemand)
    CPUGOV=""
  ;;
  powersave|performance)
    CPUGOV=$(echo $CPUGOV '|')
  ;;
esac

if [ -e /sys/kernel/debug/vgaswitcheroo/switch ]
then
  GPUSTATE=$(cat /sys/kernel/debug/vgaswitcheroo/switch |grep DIS| sed 's/.:DIS:.:\([^:]*\):.*/\1/')
  case "$GPUSTATE" in
    Pwr)
      GPUSTATE="GPU on |"
      ;;
    Off)
      GPUSTATE=""
      ;;
  esac
else
  GPUSTATE=""
fi

echo -n ' ' \
  'vol:' $ALSAVOL '|' \
  'wlan:' $WIFI '|' \
  $(acpi -a | sed 's/Adapter .: //; s/on-line/AC: /g; s/off-line/Bat :/g;') \
  $(acpi -b | sed 's/Battery .:.* \([0-9]*%\).*$/\1/') '|' \
  $CPUGOV \
  $GPUSTATE \
  $(date '+%Y-%m-%d %a  %H:%M')
