#!/usr/bin/env rc

fn dispatch{
	switch ($1) {
	case o
		sudo rfkill unblock wifi
		sudo ip link set wlan0 up
	case k
		sudo rfkill block wifi
		sudo ip link set wlan0 down
		set-status-line-bnwr
	case d
		task -k sock
		sudo pkill -9 -u root wpa_supplicant
		sudo pkill -9 -u root dhcpcd
		sudo ip link set wlan0 down
		sudo ip link set eth0 down
	case c
		sudo wpa_supplicant -B -Dwext -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
		sudo dhcpcd --timeout 60 wlan0
		set-status-line-bnwr
	case a
		sudo wpa_supplicant -B -Dwext -iwlan0 -c$HOME/bin/adhocnet.wpa_conf
	case s
		sudo ip link set wlan0 up
		sudo iwlist wlan0 scan
	case r
		sudo pkill -9 -u root dhcpcd
		sudo dhcpcd --timeout 60 wlan0
	case R
		sudo wpa_cli reassociate
	case p
		ping -c 1 -w 10 `{route -n | grep '^0.0.0.0' | tr -s ' ' '	' | cut -f 2}
	case P
		ping -c 1 -w 5 free.fr &
		ping -c 1 -w 5 google.com &
		ping -c 1 -w 5 ovh.com &
		ping -c 1 -w 5 github.com &
		ping -c 1 -w 5 twitter.com &
		wait
	case e
		sudo ip link set eth0 up
		sudo dhcpcd  --timeout 60 eth0
	case t
		if (~ `{ssh-add -L} 'The agent has no identities.') ssh-add
		task -n sock ssh -ND 4711 -v lum
	case *
		exit 'usage: conn [okdcsrpe] [..]'
	}
}

for (i) dispatch $i
