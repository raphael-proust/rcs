#!/opt/plan9/bin/rc

fn dispatch{
	switch ($1) {
	case o
		sudo rfkill unblock wifi
	case k
		sudo rfkill block wifi
		set-status-line-bnwr
	case d
		sudo pkill -9 -u root wpa_supplicant
		sudo pkill -9 -u root dhcpcd
	case c
		sudo wpa_supplicant -B -Dwext -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
		sudo dhcpcd -C resolv.conf --timeout 60 wlan0
	case s
		sudo ip link set wlan0 up
		sudo iwlist wlan0 scan
	case r
		sudo pkill -9 -u root dhcpcd
		sudo dhcpcd -C resolv.conf --timeout 60 wlan0
	case R
		sudo wpa_cli reassociate
	case p
		ping -c 1 -w 10 `{route -n | grep '^0.0.0.0' | tr -s ' ' '	' | cut -f 2}
	case e
		sudo dhcpcd -C resolv.conf --timeout 60 eth0
	case *
		exit 'usage: conn [okdcsrpe] [..]'
	}
}

for (i) dispatch $i
