#!/usr/bin/env rc

fn eth0{
	switch ($1) {
	case d
		sudo dhcpcd --release eth0
	case k
		sudo ip link set eth0 down
	case o
		sudo ip link set eth0 up
	case c
		sudo dhcpcd  --timeout 60 eth0
	case r
		sudo dhcpcd --release eth0
		sudo dhcpcd --timeout 60 eth0
	}
}
fn wlan0{
	switch ($1) {
	case d
		sudo dhcpcd --release wlan0
		sudo pkill -9 -u root wpa_supplicant
	case k
		sudo rfkill block wifi
		sudo ip link set wlan0 down
		set-status-line-bnwr
	case o
		sudo rfkill unblock wifi
		sudo ip link set wlan0 up
		set-status-line-bnwr
	case c
		sudo wpa_supplicant -B -Dwext -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
		sudo dhcpcd --timeout 60 wlan0
		set-status-line-bnwr
	case s
		sudo ip link set wlan0 up
		sudo iwlist wlan0 scan
	case r
		sudo dhcpcd --release wlan0
		sudo dhcpcd --timeout 60 wlan0
	case R
		sudo wpa_cli reassociate
	}
}
fn network{
	switch ($1) {
	case p
		ping -c 1 -w 10 `{route -n | grep '^0.0.0.0' | tr -s ' ' '	' | cut -f 2}
	case P
		ping -c 1 -w 5 free.fr &
		ping -c 1 -w 5 google.com &
		ping -c 1 -w 5 ovh.com &
		ping -c 1 -w 5 github.com &
		ping -c 1 -w 5 twitter.com &
		wait
	case t
		if (~ `{ssh-add -L} 'The agent has no identities.') ssh-add
		task -n sock ssh -ND 4711 -v lum
	}
}

switch($*(1)){
	case w
		for (i in $*(2-)) wlan0 $i
	case e
		for (i in $*(2-)) eth0 $i
	case n
		for (i in $*(2-)) network $i
}
