#!/bin/dash

TASKPIPESDIR="/tmp/task-dtach"
if ! [ -d $TASKPIPESDIR ]
then
  mkdir $TASKPIPESDIR
fi

if [ $# -eq 0 ]
then
  TASKPIPES=$(ls -1 $TASKPIPESDIR)
  if [ $(echo $TASKPIPES | wc -l) = "0" ]
  then
    echo "No dtached task found"
  else
    dtach -a $TASKPIPESDIR/$(echo $TASKPIPES | slmenu)
  fi
else
  PIPENAME=$(echo -n "$1" $(shuf -i 0-99 -n 1) | sed -e "s/ /./")
  dtach -c "$TASKPIPESDIR"/"$PIPENAME" $*
  echo "$PIPENAME"
fi

#TODO: support dtach -n
#TODO: prevent collision completely
#TODO: support explicit naming for tasks
